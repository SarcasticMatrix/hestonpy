
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Hedging with Black-Scholes &#8212; hestonpy v0.5.7 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=af91de31" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=2dea12e0"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/hedging/hedging_blackScholes';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Hedging with Heston" href="hedging_heston.html" />
    <link rel="prev" title="Hedging" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light-no-bg.png" class="logo__image only-light" alt="hestonpy v0.5.7 documentation - Home"/>
    <img src="../../_static/logo-light-no-bg.png" class="logo__image only-dark pst-js-only" alt="hestonpy v0.5.7 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Examples
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SarcasticMatrix/hestonpy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Examples
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SarcasticMatrix/hestonpy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../pricing/index.html">Pricing</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../pricing/pricing_heston.html">Pricing with Heston</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pricing/pricing_heston%20copy.html">Pricing with Bates</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../calibration/index.html">Calibration</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../calibration/calibration_synthetic_data.html">With syntetic market price</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calibration/parameters_impacts_and_stability.html">Impact of parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calibration/calibration_real_data.html">Calibration on market data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calibration/calibration_heston.html">Calibration of Heston models on market data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calibration/calibration_bates.html">Calibration of Bates models on market data</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Hedging</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Hedging with Black-Scholes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hedging_heston.html">Hedging with Heston</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Examples</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Hedging</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Hedging with Black-Scholes</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Hedging-with-Black-Scholes">
<h1>Hedging with Black-Scholes<a class="headerlink" href="#Hedging-with-Black-Scholes" title="Link to this heading">#</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import matplotlib.pyplot as plt
from hestonpy.models.blackScholes import BlackScholes

import pandas as pd
dates = pd.date_range(start=&quot;2025-01-01&quot;, end=&quot;2025-07-01&quot;, freq=&quot;D&quot;)

nbr_simulations = 1000
nbr_hedges = len(dates)-1
</pre></div>
</div>
</div>
<section id="Replication-errors">
<h2>Replication errors<a class="headerlink" href="#Replication-errors" title="Link to this heading">#</a></h2>
<p>Sanity check of the replication</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>real_vol = 0.15
hedging_vol = 0.15

bs = BlackScholes(
    spot=100, r=0.01, mu=0.05, volatility=real_vol)
strike = 110

res = bs.delta_hedging(
    flag_option=&quot;call&quot;,
    time_to_maturity=1,
    strike=strike,
    hedging_volatility=hedging_vol,
    pricing_volatility=hedging_vol,
    nbr_simulations=nbr_simulations,
    nbr_hedges=nbr_hedges,
)

portfolio = res[0]
S = res[1]

ST = S[:, -1]
VT = portfolio[:, -1]

plt.figure(figsize=(5, 5))
plt.title(&quot;Payoff replication&quot;)
plt.grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
plt.minorticks_on()
plt.xlabel(r&quot;$S_T$&quot;)
plt.ylabel(&quot;payoff&quot;)
plt.scatter(ST, VT, s=0.8, color=&quot;red&quot;)
x = np.linspace(min(ST), max(ST))
payoff = np.maximum(0, x - strike)
plt.plot(x, payoff, color=&quot;blue&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_hedging_hedging_blackScholes_4_0.png" src="../../_images/examples_hedging_hedging_blackScholes_4_0.png" />
</div>
</div>
<p>Sanity check of the replicationCheck the replication errors</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from scipy.stats import norm

cash_flows = np.maximum(0, ST - strike)
hedging_errors = VT - cash_flows

hedging_errors = np.sort(hedging_errors)
VaR95_index = int(0.05 * len(hedging_errors))
VaR95 = hedging_errors[VaR95_index]
CVaR95 = np.mean(hedging_errors[:VaR95_index])

plt.figure()

plt.title(&quot;Hedging with &quot; + r&quot;$\sigma_{iv} = $&quot; + str(hedging_vol))
plt.hist(hedging_errors, bins=&quot;fd&quot;, density=True)

plt.axvline(VaR95, color=&#39;red&#39;, label=r&#39;$VaR_{95\%}$&#39;, linestyle=&quot;dotted&quot;,alpha=0.8)
plt.axvline(CVaR95, color=&#39;red&#39;, label=r&#39;$CVaR_{95\%}$&#39;, linestyle=&quot;--&quot;, alpha=0.8)

x = np.linspace(start=min(hedging_errors), stop=max(hedging_errors), num=100)
plt.plot(
    x,
    norm.pdf(x, loc=np.mean(hedging_errors), scale=np.std(hedging_errors)),
    label=&quot;Normal density&quot;,
)
plt.grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
plt.minorticks_on()
plt.xlabel(r&quot;Hedging errors: $V_T - (S_T - K)^+$&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_hedging_hedging_blackScholes_6_0.png" src="../../_images/examples_hedging_hedging_blackScholes_6_0.png" />
</div>
</div>
<p>Looks like the hedging errors are fat tailed fat tailed</p>
</section>
<section id="Hedging-with-different-volatilities">
<h2>Hedging with different volatilities<a class="headerlink" href="#Hedging-with-different-volatilities" title="Link to this heading">#</a></h2>
<p>We analyse what is happening when we hedge with different volatilities (w.r.t to the pricing volatilities)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>implied_volatility = 0.15
hedging_vols = [0.10, 0.15, 0.20]

bs = BlackScholes(spot=100, r=0.00, mu=0.00, volatility=implied_volatility)
strike = 100
nbr_simulations = 100000

fig, axes = plt.subplots(1, 3, figsize=(15, 5), sharey=True)
for i, vol in enumerate(hedging_vols):
    res = bs.delta_hedging(
        flag_option=&quot;call&quot;,
        time_to_maturity=1,
        strike=strike,
        hedging_volatility=vol,
        nbr_simulations=nbr_simulations,
        nbr_hedges=nbr_hedges,
    )

    portfolio = res[0]
    S = res[1]

    ST = S[:, -1]
    VT = portfolio[:, -1]

    cash_flows = np.maximum(0, ST - strike)
    hedging_errors = VT - cash_flows

    hedging_errors = np.sort(hedging_errors)
    VaR95_index = int(0.05 * len(hedging_errors))
    VaR95 = hedging_errors[VaR95_index]
    CVaR95 = np.mean(hedging_errors[:VaR95_index])

    axes[i].set_title(&quot;Hedging with &quot; + r&quot;$\sigma_{h} = $&quot; + str(vol))
    axes[i].hist(hedging_errors, bins=&quot;fd&quot;, density=True, color=&quot;gray&quot;, alpha=0.8)
    axes[i].axvline(np.mean(hedging_errors), color=&quot;black&quot;, label=&quot;mean&quot;, alpha=0.8)
    axes[i].axvline(VaR95, color=&#39;red&#39;, label=r&#39;$VaR_{95\%}$&#39;, linestyle=&quot;dotted&quot;,alpha=0.8)
    axes[i].axvline(CVaR95, color=&#39;red&#39;, label=r&#39;$CVaR_{95\%}$&#39;, linestyle=&quot;--&quot;, alpha=0.8)

    x = np.linspace(start=min(hedging_errors), stop=max(hedging_errors), num=100)
    axes[i].plot(
        x,
        norm.pdf(x, loc=np.mean(hedging_errors), scale=np.std(hedging_errors)),
        label=&quot;normal density&quot;,
        color=&quot;blue&quot;,
    )
    axes[i].grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
    axes[i].minorticks_on()
    axes[i].set_xlabel(r&quot;Hedging errors: $V_T - (S_T - K)^+$&quot;)
    axes[i].legend()

plt.suptitle(
    r&quot;Priced with implied volatility $\sigma_{iv} =$&quot; + str(implied_volatility)
)
plt.tight_layout()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_hedging_hedging_blackScholes_10_0.png" src="../../_images/examples_hedging_hedging_blackScholes_10_0.png" />
</div>
</div>
</section>
<section id="Hedging-at-different-frequencies">
<h2>Hedging at different frequencies<a class="headerlink" href="#Hedging-at-different-frequencies" title="Link to this heading">#</a></h2>
<p>We analyse what is happening when we hedge daily, monthly or yearly</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>implied_volatility = 0.15
bs = BlackScholes(spot=100, r=0.00, mu=0.00, volatility=implied_volatility)
strike = 100

daily_dates = pd.date_range(start=&quot;2025-01-01&quot;, end=&quot;2025-07-01&quot;, freq=&quot;D&quot;)
monthly_dates = pd.date_range(start=&quot;2025-01-01&quot;, end=&quot;2025-07-01&quot;, freq=&quot;ME&quot;)
yearly_dates = [daily_dates[0]]

fig, axes = plt.subplots(1, 3, figsize=(15, 5), sharey=True)
for i, dates in enumerate([daily_dates, monthly_dates, yearly_dates]):
    res = bs.delta_hedging(
        flag_option=&quot;call&quot;,
        time_to_maturity=0.5,
        strike=strike,
        hedging_volatility=implied_volatility,
        nbr_simulations=nbr_simulations,
        nbr_hedges=len(dates),
    )

    portfolio = res[0]
    S = res[1]

    ST = S[:, -1]
    VT = portfolio[:, -1]

    cash_flows = np.maximum(0, ST - strike)
    hedging_errors = VT - cash_flows

    hedging_errors = np.sort(hedging_errors)

    axes[i].hist(hedging_errors, bins=&quot;fd&quot;, density=True, color=&quot;gray&quot;, alpha=0.8)
    axes[i].axvline(np.mean(hedging_errors), color=&quot;black&quot;, label=&quot;mean&quot;, alpha=0.8)

    x = np.linspace(start=min(hedging_errors), stop=max(hedging_errors), num=100)
    axes[i].plot(
        x,
        norm.pdf(x, loc=np.mean(hedging_errors), scale=np.std(hedging_errors)),
        label=&quot;normal density&quot;,
        color=&quot;blue&quot;,
    )
    axes[i].grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
    axes[i].minorticks_on()
    axes[i].set_xlabel(r&quot;Hedging errors: $V_T - (S_T - K)^+$&quot;)
    axes[i].legend()

plt.suptitle(&quot;Delta hedging with different frequency (daily, monthly and yearly)&quot;)
plt.tight_layout()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_hedging_hedging_blackScholes_13_0.png" src="../../_images/examples_hedging_hedging_blackScholes_13_0.png" />
</div>
</div>
</section>
<section id="Hedging-with-a-misspecified-model">
<h2>Hedging with a misspecified model<a class="headerlink" href="#Hedging-with-a-misspecified-model" title="Link to this heading">#</a></h2>
<p>Since the market does not have perfect knowledge about the future actual and implied volatilities can and will be different.</p>
<p>Imagine that we have a forecast for volatility over the remaining life of an option, this volatility is forecast to be constant, and further assume that our forecast turns out to be correct. We shall buy an underpriced option and delta hedge to expiry.But which delta do you choose? Delta based on actual or implied volatility?</p>
<ul class="simple">
<li><p><strong>Scenario</strong>: Implied volatility for an option is 20%, but we believe that actual volatility is 30%.</p></li>
<li><p><strong>Question</strong>: How can we make money if our forecast is correct?</p></li>
<li><p><strong>Answer</strong>: Buy the option and delta hedge. But which delta do we use?</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>np.random.seed(42)

# Model parameters
S0 = 100
mu = 0.00
r = 0.00
time_to_maturity = 1
stirke = 100

real_volatility = 0.30
implied_volatility = 0.20
model = BlackScholes(spot=100, r=r, mu=mu, volatility=real_volatility)

portfolio_iv, _ = model.volatility_arbitrage(
    pricing_volatility=implied_volatility,
    hedging_volatility=implied_volatility,
    strike=strike,
    time_to_maturity=time_to_maturity,
    flag_option=&quot;call&quot;,
    nbr_hedges=nbr_hedges,
    nbr_simulations=nbr_simulations,
)

portfolio_real, _ = model.volatility_arbitrage(
    pricing_volatility=implied_volatility,
    hedging_volatility=real_volatility,
    strike=strike,
    time_to_maturity=time_to_maturity,
    flag_option=&quot;call&quot;,
    nbr_hedges=nbr_hedges,
    nbr_simulations=nbr_simulations,
)
</pre></div>
</div>
</div>
<p>Plot the porfolio path simulations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>number_plots = 15  # must be &lt; nPaths

# Plotting results
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(10, 6), sharey=True)

time_points = np.linspace(0, 1, nbr_hedges + 1)

# Hedging with actual volatility
ax1.set_title(
    &quot;Hedging with implied volatility &quot; + r&quot;$\sigma_{iv} =$ &quot; + str(implied_volatility)
)
for i in range(number_plots):
    ax1.plot(
        time_points, portfolio_iv[i, :], color=&quot;blue&quot;, linewidth=0.8
    )  # Add transparency for better readability
ax1.grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
ax1.minorticks_on()
ax1.set_xlabel(&quot;time&quot;)
ax1.set_ylabel(&quot;Cumulative PnL&quot;)

# Hedging with implied volatility
ax2.set_title(
    &quot;Hedging with actual volatility &quot; + r&quot;$\sigma_{real} =$ &quot; + str(real_volatility)
)
for i in range(number_plots):
    ax2.plot(
        time_points, portfolio_real[i, :], color=&quot;black&quot;, linewidth=0.8
    )  # Add transparency for better readability
ax2.grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
ax2.minorticks_on()
ax2.set_xlabel(&quot;time&quot;)

plt.tight_layout()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_hedging_hedging_blackScholes_17_0.png" src="../../_images/examples_hedging_hedging_blackScholes_17_0.png" />
</div>
</div>
<p>Plot the distribution of the portfolio returns</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(8, 5), sharey=True)


ax1.set_title(
    &quot;Hedging with implied volatility &quot; + r&quot;$\sigma_{iv} =$ &quot; + str(implied_volatility)
)

final_pnl_iv = portfolio_iv[:, -1]
final_pnl_iv = np.sort(final_pnl_iv)
VaR95_index = int(0.05 * len(final_pnl_iv))
VaR95 = final_pnl_iv[VaR95_index]
CVaR95 = np.mean(final_pnl_iv[:VaR95_index])

ax1.axvline(np.mean(final_pnl_iv), color=&quot;black&quot;, label=&quot;mean&quot;, alpha=0.8)
ax1.axvline(VaR95, color=&#39;red&#39;, label=r&#39;$VaR_{95\%}$&#39;, linestyle=&quot;dotted&quot;,alpha=0.8)
ax1.axvline(CVaR95, color=&#39;red&#39;, label=r&#39;$CVaR_{95\%}$&#39;, linestyle=&quot;--&quot;, alpha=0.8)

ax1.hist(final_pnl_iv, bins=&quot;fd&quot;, density=True, color=&quot;gray&quot;, alpha=0.8)
ax1.grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
ax1.minorticks_on()
ax1.set_xlabel(&quot;$PnL_T$&quot;)



ax2.set_title(
    &quot;Hedging with actual volatility &quot; + r&quot;$\sigma_{real} =$ &quot; + str(real_volatility)
)

final_pnl_actual = portfolio_real[:, -1]
final_pnl_actual = np.sort(final_pnl_actual)
VaR95_index = int(0.05 * len(final_pnl_actual))
VaR95 = final_pnl_actual[VaR95_index]
CVaR95 = np.mean(final_pnl_actual[:VaR95_index])

ax2.axvline(np.mean(final_pnl_actual), color=&quot;black&quot;, label=&quot;mean&quot;, alpha=0.8)
ax2.axvline(VaR95, color=&#39;red&#39;, label=r&#39;$VaR_{95\%}$&#39;, linestyle=&quot;dotted&quot;,alpha=0.8)
ax2.axvline(CVaR95, color=&#39;red&#39;, label=r&#39;$CVaR_{95\%}$&#39;, linestyle=&quot;--&quot;, alpha=0.8)

ax2.hist(final_pnl_actual, bins=&quot;fd&quot;, density=True, color=&quot;gray&quot;, alpha=0.8)
ax2.grid(linestyle=&quot;--&quot;, dashes=(5, 10), color=&quot;gray&quot;, linewidth=0.5)
ax2.minorticks_on()
ax2.set_xlabel(&quot;$PnL_T$&quot;)

plt.tight_layout()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_hedging_hedging_blackScholes_19_0.png" src="../../_images/examples_hedging_hedging_blackScholes_19_0.png" />
</div>
</div>
<p>Some statistics about the two portfolio</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Statistics

# Hedging with implied volatility
final_pnl = portfolio_iv[:, -1]
mean_pnl = np.mean(final_pnl)
std_pnl = np.std(final_pnl)
pathwise_var = np.mean([np.sum(np.diff(portfolio_iv[i]) ** 2) for i in range(nbr_simulations)])

print(f&quot;Experiment 1 (blue) - Hedging with implied volatility:&quot;)
print(f&quot;  Mean PnL(T): {mean_pnl:.2f}&quot;)
print(f&quot;  Std Dev PnL(T): {std_pnl:.2f}&quot;)
print(f&quot;  Pathwise Quadratic Variation: {pathwise_var:.2f}\n&quot;)

# Hedging with actual/forecasted volatility
final_pnl = portfolio_real[:, -1]
mean_pnl = np.mean(final_pnl)
std_pnl = np.std(final_pnl)
pathwise_var = np.mean([np.sum(np.diff(portfolio_real[i]) ** 2) for i in range(nbr_simulations)])

print(f&quot;Experiment 2 (black) - Hedging with actual/forecasted volatility:&quot;)
print(f&quot;  Mean PnL(T): {mean_pnl:.2f}&quot;)
print(f&quot;  Std Dev PnL(T): {std_pnl:.2f}&quot;)
print(f&quot;  Pathwise Quadratic Variation: {pathwise_var:.2f}\n&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Experiment 1 (blue) - Hedging with implied volatility:
  Mean PnL(T): 3.96
  Std Dev PnL(T): 1.99
  Pathwise Quadratic Variation: 1.13

Experiment 2 (black) - Hedging with actual/forecasted volatility:
  Mean PnL(T): 3.96
  Std Dev PnL(T): 0.78
  Pathwise Quadratic Variation: 4.23

</pre></div></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Hedging</p>
      </div>
    </a>
    <a class="right-next"
       href="hedging_heston.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Hedging with Heston</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Replication-errors">Replication errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Hedging-with-different-volatilities">Hedging with different volatilities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Hedging-at-different-frequencies">Hedging at different frequencies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Hedging-with-a-misspecified-model">Hedging with a misspecified model</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/hedging/hedging_blackScholes.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Théophile Schmutz.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>